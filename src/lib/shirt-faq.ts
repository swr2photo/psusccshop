// src/lib/shirt-faq.ts
// ฐานข้อมูล FAQ สำหรับแชตบอทร้านค้าชุมนุม — ปรับปรุงล่าสุด 2026

export interface ShirtFAQ {
  id: string;
  question: string;
  answer: string;
  keywords: string[];
  category: 'product' | 'order' | 'payment' | 'shipping' | 'contact' | 'general';
  priority: number;
}

// คำถามยอดนิยมสำหรับ Quick Reply (ไม่ใช้ emoji — ใช้ Lucide icon แทนใน UI)
export const QUICK_QUESTIONS = [
  'วิธีสั่งซื้อ',
  'ราคาเท่าไหร่',
  'มีโค้ดส่วนลดไหม',
  'การจัดส่ง',
  'ชำระเงินยังไง',
  'ติดต่อร้าน',
];

export const SHIRT_FAQ: ShirtFAQ[] = [
  // ==================== สินค้า (Product) ====================
  {
    id: 'product-types',
    question: 'เสื้อชุมนุมมีกี่แบบ?',
    answer: 'เสื้อชุมนุม SCC มี 2 แบบหลักค่ะ\n\n• **Jersey** — เสื้อกีฬาระบายอากาศดี เหมาะใส่ทำกิจกรรมหรือออกกำลังกาย\n• **Crew** — เสื้อยืดคอกลม นุ่มสบาย สวมใส่ได้ทุกวัน\n\nเลือกดูรายละเอียดและรูปสินค้าแต่ละแบบได้ในหน้าสินค้าเลยนะคะ',
    keywords: ['แบบ', 'jersey', 'crew', 'เสื้อกีฬา', 'เสื้อยืด', 'รุ่น', 'ชนิด', 'ประเภท', 'มีอะไรบ้าง'],
    category: 'product',
    priority: 10,
  },
  {
    id: 'sizes',
    question: 'มีไซซ์อะไรบ้าง?',
    answer: 'ไซซ์ที่มีจำหน่ายค่ะ\n\n• ไซซ์มาตรฐาน — **XS, S, M, L** ราคาปกติ\n• ไซซ์ใหญ่ — **XL, 2XL, 3XL** ขึ้นไป ราคาปรับเพิ่มเล็กน้อย\n\nแนะนำให้ดูตารางไซซ์ในหน้าสินค้าเพื่อวัดขนาดก่อนสั่งจะได้พอดีตัวค่ะ',
    keywords: ['ไซซ์', 'ขนาด', 'size', 'xs', 's', 'm', 'l', 'xl', '2xl', '3xl', 'ตาราง', 'วัด', 'ไซส์'],
    category: 'product',
    priority: 9,
  },
  {
    id: 'price',
    question: 'ราคาเสื้อเท่าไหร่?',
    answer: 'ราคาเสื้อชุมนุม SCC ค่ะ\n\n• **ไซซ์ XS-L** — เริ่มต้น 319 บาท\n• **ไซซ์ XL ขึ้นไป** — ราคาปรับตามไซซ์\n\nราคาอาจแตกต่างกันตามรุ่นสินค้า ดูราคาจริงและออปชั่นเพิ่มเติมได้ในหน้าสินค้าเลยค่ะ',
    keywords: ['ราคา', 'เท่าไหร่', 'บาท', 'กี่บาท', 'ค่าใช้จ่าย', 'แพง', 'ถูก', 'เงิน', 'price', '319'],
    category: 'product',
    priority: 10,
  },
  {
    id: 'colors',
    question: 'มีสีอะไรบ้าง?',
    answer: 'สีของเสื้อจะขึ้นอยู่กับรุ่นที่เลือกค่ะ แต่ละรุ่นจะมีแสดงในหน้าสินค้า บางรุ่นอาจมีหลายสีให้เลือกด้วยนะคะ',
    keywords: ['สี', 'color', 'ดำ', 'ขาว', 'น้ำเงิน', 'แดง', 'เขียว'],
    category: 'product',
    priority: 7,
  },
  {
    id: 'custom-name',
    question: 'สามารถสกรีนชื่อ/เบอร์ได้ไหม?',
    answer: 'ขึ้นอยู่กับสินค้าที่เลือกค่ะ บางรุ่นสามารถเลือกออปชั่นเพิ่มได้\n\n• **สกรีนชื่อ** — ใส่ชื่อที่ต้องการบนเสื้อ (ฟรี)\n• **สกรีนเบอร์** — เลือกหมายเลขได้ (ฟรี)\n• **แขนยาว** — ตัวเลือกเพิ่มเติม มีค่าใช้จ่ายเพิ่ม\n\nดูรายละเอียดออปชั่นได้ที่หน้าสั่งซื้อแต่ละสินค้าเลยค่ะ',
    keywords: ['สกรีน', 'ชื่อ', 'เบอร์', 'custom', 'ปัก', 'พิมพ์', 'แขนยาว', 'long sleeve'],
    category: 'product',
    priority: 8,
  },
  {
    id: 'material',
    question: 'เนื้อผ้าเป็นอย่างไร?',
    answer: 'เนื้อผ้าคุณภาพดีทั้งสองแบบค่ะ\n\n• **Jersey** — ผ้าโพลีเอสเตอร์ ระบายอากาศดี แห้งเร็ว เหมาะกับกิจกรรม\n• **Crew** — ผ้าฝ้ายผสม นุ่มสบาย ใส่ได้ทุกวัน\n\nทุกตัวผลิตจากโรงงานคุณภาพ สกรีนลายคมชัดค่ะ',
    keywords: ['ผ้า', 'เนื้อผ้า', 'วัสดุ', 'cotton', 'โพลี', 'ระบาย', 'หนา', 'บาง'],
    category: 'product',
    priority: 6,
  },

  // ==================== การสั่งซื้อ (Order) ====================
  {
    id: 'how-to-order',
    question: 'สั่งซื้ออย่างไร?',
    answer: 'วิธีสั่งซื้อง่ายๆ มี 6 ขั้นตอนค่ะ\n\n1. เลือกสินค้าที่ต้องการ\n2. เลือกไซซ์และออปชั่นต่างๆ\n3. กด "เพิ่มลงตะกร้า"\n4. กดไอคอนตะกร้าด้านบนขวา\n5. ตรวจสอบรายการแล้วกดสั่งซื้อ\n6. กรอกข้อมูลและชำระเงิน\n\nเสร็จแล้วรอรับสินค้าได้เลยค่ะ',
    keywords: ['สั่งซื้อ', 'วิธี', 'order', 'ซื้อ', 'ยังไง', 'อย่างไร', 'ขั้นตอน', 'เริ่ม', 'สั่ง'],
    category: 'order',
    priority: 10,
  },
  {
    id: 'order-status',
    question: 'เช็คสถานะออเดอร์ได้ยังไง?',
    answer: 'เช็คสถานะออเดอร์ได้ง่ายๆ ค่ะ\n\n1. Login เข้าสู่ระบบ\n2. กดที่ไอคอน "ออเดอร์ของฉัน"\n3. จะเห็นรายการและสถานะทั้งหมด\n\nสถานะจะอัปเดตอัตโนมัติเมื่อมีการเปลี่ยนแปลง ไม่ต้องกังวลค่ะ',
    keywords: ['สถานะ', 'status', 'ตรวจสอบ', 'เช็ค', 'ออเดอร์', 'คำสั่งซื้อ', 'ติดตาม', 'track'],
    category: 'order',
    priority: 8,
  },
  {
    id: 'cancel-order',
    question: 'ยกเลิกออเดอร์ได้ไหม?',
    answer: 'ขึ้นอยู่กับสถานะการชำระเงินค่ะ\n\n• **ก่อนชำระเงิน** — ยกเลิกได้เลย หรือรอให้หมดอายุอัตโนมัติ (24 ชม.)\n• **หลังชำระเงินแล้ว** — ไม่สามารถยกเลิกได้\n\nหากมีปัญหาหรือต้องการความช่วยเหลือ ติดต่อทีมงานได้เลยค่ะ',
    keywords: ['ยกเลิก', 'cancel', 'เลิก', 'ไม่เอา', 'คืนเงิน'],
    category: 'order',
    priority: 7,
  },
  {
    id: 'edit-order',
    question: 'แก้ไขออเดอร์ได้ไหม?',
    answer: 'การแก้ไขออเดอร์ค่ะ\n\n• **ก่อนชำระเงิน** — ยกเลิกแล้วสั่งใหม่ได้เลย\n• **หลังชำระแล้ว** — ไม่สามารถแก้ไขได้\n\nแนะนำให้ตรวจสอบรายละเอียดให้ดีก่อนชำระเงินนะคะ',
    keywords: ['แก้ไข', 'edit', 'เปลี่ยน', 'แก้', 'ไซซ์ผิด'],
    category: 'order',
    priority: 6,
  },

  // ==================== การชำระเงิน (Payment) ====================
  {
    id: 'payment-methods',
    question: 'ชำระเงินอย่างไร?',
    answer: 'วิธีชำระเงินค่ะ\n\n• **PromptPay** — สแกน QR Code จ่ายง่ายสะดวก\n• **โอนธนาคาร** — โอนตามเลขบัญชีที่แสดงในออเดอร์\n\nหลังโอนแล้ว อัปโหลดสลิปยืนยันในระบบ รอตรวจสอบไม่เกิน 24 ชม. ค่ะ',
    keywords: ['ชำระเงิน', 'โอน', 'promptpay', 'จ่ายเงิน', 'บัญชี', 'payment', 'qr', 'สแกน', 'จ่าย'],
    category: 'payment',
    priority: 10,
  },
  {
    id: 'upload-slip',
    question: 'อัปโหลดสลิปยังไง?',
    answer: 'วิธีอัปโหลดสลิปค่ะ\n\n1. หลังโอนเงินเรียบร้อยแล้ว\n2. กดปุ่ม "อัปโหลดสลิป" ที่ออเดอร์ของคุณ\n3. เลือกไฟล์รูปสลิปจากมือถือ/คอม\n4. รอระบบตรวจสอบ ปกติไม่เกิน 24 ชม.\n\nเมื่อผ่านจะเปลี่ยนสถานะเป็น "ชำระแล้ว" อัตโนมัติค่ะ',
    keywords: ['สลิป', 'slip', 'อัปโหลด', 'upload', 'หลักฐาน', 'โอนแล้ว'],
    category: 'payment',
    priority: 9,
  },
  {
    id: 'payment-deadline',
    question: 'ต้องชำระเงินภายในเมื่อไหร่?',
    answer: 'กำหนดชำระเงินค่ะ\n\n• ภายใน **24 ชั่วโมง** หลังสั่งซื้อ\n• ถ้าไม่ชำระตามกำหนด ออเดอร์จะถูกยกเลิกอัตโนมัติ\n\nรีบชำระภายในกำหนดเพื่อรักษาสิทธิ์สั่งซื้อนะคะ',
    keywords: ['ภายใน', 'กำหนด', 'deadline', 'หมดเวลา', 'กี่วัน', 'กี่ชั่วโมง'],
    category: 'payment',
    priority: 8,
  },
  {
    id: 'slip-rejected',
    question: 'สลิปไม่ผ่านทำยังไง?',
    answer: 'ถ้าสลิปไม่ผ่านการตรวจสอบค่ะ\n\n1. ตรวจสอบว่าโอนถูกจำนวนเงินหรือไม่\n2. ตรวจสอบว่าสลิปถ่ายชัดเจนหรือไม่\n3. ติดต่อทีมงานพร้อมแจ้งเลข Order\n\nทีมงานจะช่วยแก้ไขให้โดยเร็วค่ะ ไม่ต้องกังวลนะคะ',
    keywords: ['ไม่ผ่าน', 'reject', 'สลิป', 'ผิดพลาด', 'ล้มเหลว'],
    category: 'payment',
    priority: 7,
  },

  // ==================== การจัดส่ง/รับสินค้า (Shipping) ====================
  {
    id: 'delivery-time',
    question: 'เสื้อจะได้รับเมื่อไหร่?',
    answer: 'กำหนดรับเสื้อค่ะ\n\n• หลังปิดรอบสั่งซื้อจะเริ่มผลิตเสื้อ\n• ใช้เวลาผลิตประมาณ 2-4 สัปดาห์\n• มีประกาศแจ้งวันรับทางเว็บไซต์และโซเชียล\n\nติดตามข่าวสารได้ที่ Facebook หรือ Instagram ของชุมนุมนะคะ',
    keywords: ['รับเสื้อ', 'เมื่อไหร่', 'วันไหน', 'ส่ง', 'รับ', 'delivery', 'กี่วัน', 'นานไหม'],
    category: 'shipping',
    priority: 9,
  },
  {
    id: 'pickup-location',
    question: 'รับสินค้าที่ไหน?',
    answer: 'จุดรับสินค้าค่ะ\n\n• รับที่ **ชุมนุมคอมพิวเตอร์** คณะวิทยาศาสตร์ ม.อ. วิทยาเขตหาดใหญ่\n• วัน-เวลาจะประกาศอีกครั้งหลังเสื้อผลิตเสร็จ\n\nสามารถให้เพื่อนรับแทนได้ค่ะ แค่แจ้งชื่อและเลข Order',
    keywords: ['ที่ไหน', 'สถานที่', 'รับ', 'location', 'pickup', 'จุดรับ'],
    category: 'shipping',
    priority: 8,
  },
  {
    id: 'shipping-home',
    question: 'ส่งถึงบ้านได้ไหม?',
    answer: 'การจัดส่งถึงบ้านค่ะ\n\n• สามารถเลือกจัดส่งทางไปรษณีย์ได้ (ถ้าเปิดให้บริการ)\n• ค่าจัดส่งขึ้นอยู่กับตัวเลือกการจัดส่งที่เปิดให้\n• ดูรายละเอียดตัวเลือกการจัดส่งที่หน้าสั่งซื้อ\n\nหากมีคำถาม ติดต่อทีมงานได้เลยนะคะ',
    keywords: ['ส่งบ้าน', 'ส่งถึงบ้าน', 'จัดส่ง', 'ไปรษณีย์', 'kerry', 'flash'],
    category: 'shipping',
    priority: 6,
  },

  // ==================== นโยบาย (Policy) ====================
  {
    id: 'return-policy',
    question: 'เปลี่ยน/คืนสินค้าได้ไหม?',
    answer: 'นโยบายเปลี่ยน/คืนค่ะ\n\n• **โดยปกติ** — ไม่รับเปลี่ยนหรือคืน\n• **ข้อยกเว้น** — สินค้ามีตำหนิจากการผลิต\n\nกรุณาตรวจสอบไซซ์จากตารางไซซ์ก่อนสั่งซื้อเพื่อความมั่นใจนะคะ',
    keywords: ['เปลี่ยน', 'คืน', 'refund', 'exchange', 'ไม่พอใจ', 'ผิดไซซ์', 'return'],
    category: 'general',
    priority: 7,
  },
  {
    id: 'defect-product',
    question: 'ถ้าสินค้ามีตำหนิทำยังไง?',
    answer: 'กรณีสินค้ามีตำหนิค่ะ\n\n1. ถ่ายรูปจุดที่มีปัญหาให้ชัดเจน\n2. ติดต่อทีมงานพร้อมแจ้งเลข Order\n3. ทีมงานจะตรวจสอบและดำเนินการแก้ไขให้\n\nรับประกันปัญหาจากการผลิตเสมอค่ะ',
    keywords: ['ตำหนิ', 'เสีย', 'พัง', 'ขาด', 'ผิดปกติ', 'defect'],
    category: 'general',
    priority: 6,
  },

  // ==================== ติดต่อ (Contact) ====================
  {
    id: 'contact-info',
    question: 'สอบถามเพิ่มเติมได้ที่ไหน?',
    answer: 'ช่องทางติดต่อทีมงานค่ะ\n\n• **Facebook** — ชุมนุมคอมพิวเตอร์ คณะวิทยาศาสตร์ ม.อ.\n• **Instagram** — @psuscc\n• **Email** — psuscc@psusci.club\n• **แชทในเว็บ** — กดปุ่มแชทด้านล่างขวาได้เลย\n\nทีมงานพร้อมช่วยเหลือเสมอค่ะ',
    keywords: ['สอบถาม', 'ติดต่อ', 'facebook', 'instagram', 'ถาม', 'line', 'โทร', 'contact'],
    category: 'contact',
    priority: 8,
  },

  // ==================== โค้ดส่วนลด & โปรโมชั่น ====================
  {
    id: 'promo-code',
    question: 'มีโค้ดส่วนลดไหม?',
    answer: 'โค้ดส่วนลดค่ะ\n\n• ทีมงานจะประกาศโค้ดส่วนลดผ่านทาง Facebook, Instagram และประกาศในเว็บ\n• ใส่โค้ดส่วนลดได้ที่หน้า **Checkout** ก่อนชำระเงิน\n• กรอกโค้ดแล้วกด "ใช้โค้ด" ระบบจะคำนวณส่วนลดให้อัตโนมัติ\n\nดูโค้ดที่ใช้ได้ในข้อมูลร้านค้าด้านบนนะคะ',
    keywords: ['โค้ด', 'ส่วนลด', 'โปรโมชั่น', 'คูปอง', 'promo', 'coupon', 'discount', 'code', 'ลดราคา'],
    category: 'general',
    priority: 9,
  },
  {
    id: 'event-discount',
    question: 'กิจกรรมลดราคาทำงานยังไง?',
    answer: 'ระบบกิจกรรมลดราคาค่ะ\n\n• สินค้าที่อยู่ในกิจกรรม จะแสดง **ราคาลด** บนการ์ดสินค้า\n• ราคาเดิมจะขีดทับ พร้อมแสดงราคาใหม่สีแดง\n• ส่วนลดมีผลตามช่วงเวลากิจกรรมเท่านั้น\n• หลังกิจกรรมจบ ราคาจะกลับเป็นปกติอัตโนมัติ\n\nดูกิจกรรมที่กำลังมีได้ด้านบนของหน้าร้านค่ะ',
    keywords: ['กิจกรรม', 'event', 'ลดราคา', 'sale', 'โปร', 'promotion'],
    category: 'general',
    priority: 8,
  },
  {
    id: 'refund',
    question: 'ขอคืนเงินได้ไหม?',
    answer: 'การขอคืนเงิน (Refund) ค่ะ\n\n• **สินค้าชำรุด/ผิดจากที่สั่ง** — ขอ Refund ได้ผ่านระบบในหน้าประวัติคำสั่งซื้อ\n• ถ่ายรูปปัญหา แล้วกด "ขอคืนเงิน" ในออเดอร์\n• ทีมงานจะตรวจสอบและดำเนินการคืนเงิน\n• **ทั่วไป** — ไม่รับเปลี่ยน/คืนสินค้าที่ไม่มีปัญหา',
    keywords: ['refund', 'คืนเงิน', 'ขอเงินคืน', 'เงินคืน'],
    category: 'general',
    priority: 7,
  },
  {
    id: 'share-product',
    question: 'แชร์สินค้าให้เพื่อนยังไง?',
    answer: 'วิธีแชร์สินค้าค่ะ\n\n• กดปุ่ม **แชร์** (ไอคอนลูกศร) ที่มุมการ์ดสินค้า\n• หรือกดแชร์ในหน้ารายละเอียดสินค้า\n• ระบบจะสร้างลิงก์สั้นให้อัตโนมัติ\n• สามารถส่งลิงก์ผ่าน LINE, Facebook หรือแอปอื่นได้เลย\n\nเพื่อนที่เปิดลิงก์จะเห็นหน้าสินค้าทันทีค่ะ',
    keywords: ['แชร์', 'share', 'ส่งให้เพื่อน', 'ลิงก์', 'link', 'ส่งต่อ'],
    category: 'general',
    priority: 6,
  },
  {
    id: 'tracking',
    question: 'ติดตามพัสดุยังไง?',
    answer: 'ติดตามสถานะจัดส่งค่ะ\n\n• ไปที่หน้า **ประวัติคำสั่งซื้อ**\n• เลือกออเดอร์ที่ต้องการ\n• ดูสถานะจัดส่งและเลขพัสดุ\n• ระบบจะอัปเดตสถานะอัตโนมัติ\n\nหากมีข้อสงสัย ติดต่อทีมงานได้เลยนะคะ',
    keywords: ['ติดตาม', 'track', 'tracking', 'พัสดุ', 'เลขพัสดุ', 'สถานะจัดส่ง'],
    category: 'shipping',
    priority: 7,
  },

  // ==================== ทั่วไป (General) ====================
  {
    id: 'greeting-hello',
    question: 'สวัสดี',
    answer: 'สวัสดีค่ะ! ยินดีต้อนรับสู่ SCC Shop\n\nมีอะไรให้ช่วยไหมคะ? สามารถถามเกี่ยวกับ\n• การสั่งซื้อ\n• ราคาสินค้า\n• ไซซ์และขนาด\n• การชำระเงิน\n\nพิมพ์ถามได้เลยนะคะ ยินดีให้บริการค่ะ',
    keywords: ['สวัสดี', 'hello', 'hi', 'หวัดดี', 'ดี', 'ฮาย'],
    category: 'general',
    priority: 5,
  },
  {
    id: 'thanks',
    question: 'ขอบคุณ',
    answer: 'ยินดีค่ะ! หากมีคำถามเพิ่มเติม สามารถถามได้ตลอดนะคะ\n\nขอให้ช้อปปิ้งอย่างมีความสุขค่ะ',
    keywords: ['ขอบคุณ', 'thanks', 'thank', 'thx'],
    category: 'general',
    priority: 3,
  },
  {
    id: 'shop-open',
    question: 'ร้านเปิดรับออเดอร์ไหม?',
    answer: 'ดูสถานะร้านค้าได้ที่หน้าแรกของเว็บไซต์เลยค่ะ จะมีแสดงว่าเปิดหรือปิดรับออเดอร์อยู่\n\nหากร้านปิดอยู่ สามารถติดตามข่าวเปิดรอบใหม่ได้ทาง Facebook หรือ Instagram ค่ะ',
    keywords: ['เปิด', 'ปิด', 'รับออเดอร์', 'สั่งได้', 'open', 'close'],
    category: 'general',
    priority: 8,
  },
  {
    id: 'what-is-sccshop',
    question: 'SCC Shop คืออะไร?',
    answer: '**SCC Shop** คือร้านค้าออนไลน์ของชุมนุมคอมพิวเตอร์ (Science Computer Club — SCC) คณะวิทยาศาสตร์ มหาวิทยาลัยสงขลานครินทร์ วิทยาเขตหาดใหญ่\n\nจำหน่ายเสื้อและสินค้าของชุมนุม รายได้นำไปใช้ในกิจกรรมพัฒนานักศึกษาค่ะ',
    keywords: ['scc', 'shop', 'คืออะไร', 'เกี่ยวกับ', 'ชุมนุม', 'คณะ'],
    category: 'general',
    priority: 4,
  },
];

// ==================== Improved Search Algorithm ====================

function calculateMatchScore(query: string, faq: ShirtFAQ): number {
  const q = query.toLowerCase().trim();
  let score = 0;
  
  if (q === faq.question.toLowerCase()) {
    score += 100;
  } else if (q.includes(faq.question.toLowerCase()) || faq.question.toLowerCase().includes(q)) {
    score += 50;
  }
  
  const matchedKeywords = faq.keywords.filter(k => q.includes(k.toLowerCase()));
  score += matchedKeywords.length * 15;
  
  if (q.length <= 10 && matchedKeywords.length > 0) {
    score += 10;
  }
  
  score += faq.priority;
  
  return score;
}

export function findShirtFAQ(query: string): ShirtFAQ | null {
  if (!query || query.trim().length === 0) return null;
  
  const q = query.toLowerCase().trim();
  
  const scored = SHIRT_FAQ.map(faq => ({
    faq,
    score: calculateMatchScore(q, faq)
  })).filter(item => item.score > 10);
  
  scored.sort((a, b) => b.score - a.score);
  
  if (scored.length > 0 && scored[0].score >= 15) {
    return scored[0].faq;
  }
  
  return null;
}

export function findRelatedFAQs(query: string, limit = 3): ShirtFAQ[] {
  if (!query || query.trim().length === 0) return [];
  
  const q = query.toLowerCase().trim();
  
  const scored = SHIRT_FAQ.map(faq => ({
    faq,
    score: calculateMatchScore(q, faq)
  })).filter(item => item.score > 5);
  
  scored.sort((a, b) => b.score - a.score);
  
  return scored.slice(0, limit).map(item => item.faq);
}

export function getFAQsByCategory(category: ShirtFAQ['category']): ShirtFAQ[] {
  return SHIRT_FAQ.filter(faq => faq.category === category)
    .sort((a, b) => b.priority - a.priority);
}
